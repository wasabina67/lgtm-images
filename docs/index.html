<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LGTM Images</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>LGTM Images</h1>
    <p class="subtitle">Looks Good To Me - Anime Style Gallery</p>
    <div id="gallery" class="gallery">
      <div class="loading">Loading images...</div>
    </div>
  </div>

  <div id="modal" class="modal">
    <div class="modal-content">
      <button class="close-btn">&times;</button>
      <img id="modal-image" src="" alt="">
    </div>
  </div>

  <script>
    const CONFIG = {
      BASE_URL: 'https://wasabina67.is-a.dev/lgtm-images',
      IMAGES_DIR: 'images/',
      IMAGE_COUNT: 13,
      COPY_FEEDBACK_DURATION: 2000,
      ICONS: {
        COPY: 'ðŸ“‹',
        COPIED: 'âœ…'
      }
    };

    const gallery = document.getElementById('gallery');
    const modal = document.getElementById('modal');
    const modalImage = document.getElementById('modal-image');
    const closeBtn = document.querySelector('.close-btn');

    function loadImages() {
      const imageFiles = Array.from(
        { length: CONFIG.IMAGE_COUNT },
        (_, i) => `${CONFIG.IMAGE_COUNT - i}.png`
      );

      displayImages(imageFiles);
    }

    function displayImages(imageFiles) {
      gallery.innerHTML = '';
      imageFiles.forEach(filename => {
        gallery.appendChild(createImageCard(filename));
      });
    }

    function createImageCard(filename) {
      const imagePath = `${CONFIG.IMAGES_DIR}${filename}`;

      const card = document.createElement('div');
      card.className = 'image-card';

      const imageWrapper = document.createElement('div');
      imageWrapper.className = 'image-wrapper';

      const img = document.createElement('img');
      img.src = imagePath;
      img.alt = filename;
      img.loading = 'lazy';

      const copyBtn = createCopyButton(filename);

      imageWrapper.append(img, copyBtn);
      imageWrapper.onclick = () => openModal(imagePath);

      card.appendChild(imageWrapper);

      return card;
    }

    function createCopyButton(filename) {
      const button = document.createElement('button');
      button.className = 'copy-btn';
      button.textContent = CONFIG.ICONS.COPY;
      button.title = 'Copy Markdown';
      button.onclick = (e) => {
        e.stopPropagation();
        copyMarkdown(filename, button);
      };
      return button;
    }

    function showCopyFeedback(button) {
      const originalText = button.textContent;
      button.textContent = CONFIG.ICONS.COPIED;
      button.classList.add('copied');

      setTimeout(() => {
        button.textContent = originalText;
        button.classList.remove('copied');
      }, CONFIG.COPY_FEEDBACK_DURATION);
    }

    async function copyMarkdown(filename, button) {
      const imageUrl = `${CONFIG.BASE_URL}/images/${filename}`;
      const markdownText = `![LGTM](${imageUrl})`;

      try {
        await navigator.clipboard.writeText(markdownText);
        showCopyFeedback(button);
      } catch (error) {
        console.error('Failed to copy:', error);
        alert('Failed to copy Markdown');
      }
    }

    function openModal(imageSrc) {
      modalImage.src = imageSrc;
      modal.classList.add('active');
    }

    function closeModal() {
      modal.classList.remove('active');
    }

    closeBtn.onclick = closeModal;
    modal.onclick = (e) => e.target === modal && closeModal();
    document.addEventListener('keydown', (e) => e.key === 'Escape' && closeModal());

    loadImages();
  </script>
</body>
</html>
